<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Coin Listing Grid</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://cdn.jsdelivr.net/npm/daisyui@4.12.10/dist/full.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  .sparkline-canvas {
    width: 100% !important;
    height: 70px !important; /* fixed height */
  }
</style>
</head>
<body class="bg-gray-100 text-gray-900 p-6">

<!-- Navbar -->
<div class="navbar bg-base-100 shadow-md flex justify-between items-center px-4 mb-6">
  <h1 class="text-2xl font-bold">üìä Coin Listing App</h1>
  <button class="btn btn-sm btn-outline" onclick="toggleTheme()">üåô/‚òÄÔ∏è</button>
</div>

<!-- Controls -->
<div class="flex gap-4 mb-4">
  <button id="sortTop" class="btn btn-sm btn-primary">Top</button>
  <button id="sortTrending" class="btn btn-sm btn-secondary">Trending</button>
  <input type="text" id="coinSearch" placeholder="Search coins..." class="input input-bordered flex-1">
</div>

<!-- Coin Grid -->
<div id="coinGrid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6"></div>

<script>
function toggleTheme() {
  const html = document.documentElement;
  html.setAttribute("data-theme", html.getAttribute("data-theme") === "light" ? "dark" : "light");
}

const coins = [
  { name: "Bitcoin", id: "bitcoin", color: "#22c55e" },
  { name: "Ethereum", id: "ethereum", color: "#6366f1" },
  { name: "Solana", id: "solana", color: "#00ffcc" },
  { name: "Cardano", id: "cardano", color: "#3b82f6" },
  { name: "Ripple", id: "ripple", color: "#10b981" },
  { name: "Dogecoin", id: "dogecoin", color: "#facc15" },
  { name: "Polkadot", id: "polkadot", color: "#f472b6" },
  { name: "BNB", id: "binancecoin", color: "#f59e0b" },
  { name: "Litecoin", id: "litecoin", color: "#9ca3af" },
  { name: "Polygon", id: "matic-network", color: "#8b5cf6" },
  { name: "Avalanche", id: "avalanche-2", color: "#ef4444" },
  { name: "Tron", id: "tron", color: "#14b8a6" },
  { name: "Cosmos", id: "cosmos", color: "#06b6d4" },
  { name: "Uniswap", id: "uniswap", color: "#ec4899" },
  { name: "Shiba Inu", id: "shiba-inu", color: "#f87171" },
];

const chartDataSamples = {
  bitcoin: [42000, 43000, 42500, 44000, 44500],
  ethereum: [3100, 3200, 3150, 3000, 3050],
  solana: [120, 125, 130, 128, 132],
  cardano: [0.45, 0.48, 0.47, 0.46, 0.49],
  ripple: [0.5, 0.52, 0.51, 0.53, 0.52],
  dogecoin: [0.08, 0.085, 0.083, 0.087, 0.085],
  polkadot: [6, 6.2, 6.1, 6.3, 6.5],
  binancecoin: [320, 325, 318, 330, 322],
  litecoin: [95, 97, 93, 98, 96],
  "matic-network": [0.8, 0.82, 0.81, 0.85, 0.83],
  "avalanche-2": [33, 34, 32, 35, 34],
  tron: [0.1, 0.11, 0.105, 0.112, 0.11],
  cosmos: [11, 12, 11.5, 12.2, 12],
  uniswap: [7, 7.5, 7.2, 7.6, 7.4],
  "shiba-inu": [0.000008, 0.000009, 0.0000085, 0.0000092, 0.000009],
};

const vanryRate = 3.67;

// Update prices from CoinGecko
async function updatePrices() {
  const coinIds = coins.map(c => c.id).join(",");
  const response = await fetch(`https://api.coingecko.com/api/v3/simple/price?ids=${coinIds}&vs_currencies=usd`);
  const data = await response.json();
  coins.forEach(coin => {
    coin.price = data[coin.id]?.usd || 0;
  });
  renderCoinGrid();
}

// Render coin grid
function renderCoinGrid(filterText = "") {
  const grid = document.getElementById("coinGrid");
  grid.innerHTML = "";

  coins.filter(c => c.name.toLowerCase().includes(filterText.toLowerCase())).forEach(coin => {
    const card = document.createElement("div");
    card.className = "bg-base-100 p-4 rounded-lg shadow flex flex-col items-center cursor-pointer hover:shadow-md transition";

    const priceUSD = (coin.price).toFixed(2);
    const priceV = (priceUSD * vanryRate).toFixed(2);

    card.innerHTML = `
      <h3 class="font-bold text-lg mb-1">${coin.name}</h3>
      <p class="mb-2">$${coin.price.toFixed(2)} / ${(coin.price * vanryRate).toFixed(2)}V</p>
      <canvas id="spark-${coin.id}" class="sparkline-canvas" width="150" height="50"></canvas>
    `;

    grid.appendChild(card);

    // Normalize chart data 0‚Äì100
    const prices = chartDataSamples[coin.id];
    const min = Math.min(...prices);
    const max = Math.max(...prices);
    const normalized = min === max ? prices.map(() => 50) : prices.map(p => ((p - min) / (max - min)) * 100);

    const ctxSpark = document.getElementById(`spark-${coin.id}`).getContext("2d");
    new Chart(ctxSpark, {
      type: "line",
      data: {
        labels: ["Day 1","Day 2","Day 3","Day 4","Day 5"],
        datasets: [{
          data: chartDataSamples[coin.id], // use actual prices
          borderColor: coin.color,
          backgroundColor: "transparent",
          tension: 0.3,
          borderWidth: 2,
          pointRadius: 0
        }]
      },
      options: {
        plugins: { legend: { display: false } },
        scales: { x: { display: true }, y: { display: true } },
        responsive: true,
        maintainAspectRatio: false
      }
    });
  });
}

// Search
document.getElementById("coinSearch").addEventListener("input", e => {
  renderCoinGrid(e.target.value);
});

// Sort by Top (price descending)
document.getElementById("sortTop").addEventListener("click", () => {
  coins.sort((a,b) => b.price - a.price);
  renderCoinGrid(document.getElementById("coinSearch").value);
});

// Sort by Trending (% change last 5 points)
document.getElementById("sortTrending").addEventListener("click", () => {
  coins.sort((a,b) => {
    const aChange = (chartDataSamples[a.id].slice(-1)[0] - chartDataSamples[a.id][0]) / chartDataSamples[a.id][0];
    const bChange = (chartDataSamples[b.id].slice(-1)[0] - chartDataSamples[b.id][0]) / chartDataSamples[b.id][0];
    return bChange - aChange;
  });
  renderCoinGrid(document.getElementById("coinSearch").value);
});

// Initialize
updatePrices();
setInterval(updatePrices, 60000);
</script>

</body>
</html>
